<HTML>
    <Head>
        <title>RIVALRY ANALYTICS</title>   
    </Head>
<body>

    <h1>Field Scout v1.0</h1>
    <!--EACH OF THE INPUTS-->
    <div id="input-area" style="background: #f4f4f4; padding: 20px; border-radius: 8px; display: inline-block;">

    <!--PLAYER NAME-->
        <input type="text" id="PlayerName" placeholder="Player Name">

    <!--PITCH TYPE-->
        <select id="PitchType">
            <option value="" disabled selected hidden>Pitch Type</option>
            <option value="Fastball">Fastball</option>
            <option value="Curveball">Curveball</option>
            <option value="Changeup">Changeup</option>
            <option value="Slider">Slider</option>
            <option value="Other">Other</option>
        </select>

    <!--PITCH VELO-->
        <input type="number" id="PitchVelo" placeholder="Pitch Velo">

    <!--PITCH OUTCOME-->
        <select id="PitchOutcome">
            <option value="" disabled selected hidden>Pitch Outcome</option>
            <option value="SS">Strike Swinging</option>
            <option value="SL">Strike Looking</option>
            <option value="SC">Strike Check Swing</option>
            <option value="FB">Foul Ball</option>
            <option value="B">Ball</option>
            <option value="IP-Out">In-Play Out</option>
            <option value="IP-Hit">In-Play Hit</option>
            <option value="IP-Sac">In-Play Sac</option>
        </select>

    <!--SWING OUTCOME-->
        <select id="SwingOutcome">
            <option value="" disabled selected hidden>Swing Outcome</option>
            <option value="Miss">Miss</option>
            <option value="FT">Foul Tip</option>
            <option value="FB">Foul Ball</option>
            <option value="LD">Line Drive</option>
            <option value="GB">Ground Ball</option>
            <option value="PF">Pop Fly</option>
        </select>

    <!--EXIT VELO-->
        <input type="number" id="ExitVelo" placeholder="Exit Velo">
    
    <!--RECORD EVENT-->
        <button onclick="recordPlay()" style="background-color: #007bff; color: white;">Record Event</button>
    </div>

   <!--COUNT AND OUT INDICATOR-->
    <div id="input-area" style="background: #f4f4f4; padding: 20px; border-radius: 8px; display: inline-block;">
        
    </div>
    
    <!--HIT LOCATION-->
    <svg id="field" viewBox="0 0 500 500">
        <image
            href="Collection App/FieldDigram.jpeg"
            xlink:href="Collection App/FieldDigram.jpeg"
            width="500"
            height="500"
        />
        <circle id="marker" r="5" fill="red" style="display:none;" />
    </svg>

    <input type="hidden" id="sprayX" name="sprayX">
    <input type="hidden" id="sprayY" name="sprayY">

    <script>
        let hitlocXX = null;
        let hitlocYY = null;

        const field = document.getElementById("field");
        const marker = document.getElementById("marker");
        const sprayXInput = document.getElementById("sprayX");
        const sprayYInput = document.getElementById("sprayY");
            field.addEventListener("click", (e) => {
                const rect = field.getBoundingClientRect();

                hitlocXX = ((e.clientX - rect.left) / rect.width) * 500;
                hitlocYY = ((e.clientY - rect.top) / rect.height) * 500;

                marker.setAttribute("cx", hitlocXX);
                marker.setAttribute("cy", hitlocYY);
                marker.style.display = "block";

                sprayXInput.value = (hitlocXX / 500).toFixed(4);
                sprayYInput.value = (hitlocYY / 500).toFixed(4);
            });
    </script>

    <!--EXPORT CSV-->
    <button onclick="downloadCSV()"" style="background-color: #ff0000; color: white;">Export CSV</button>


<script>
    let sessionData = [];

    function recordPlay() {
        // Get values from the inputs
        const name = document.getElementById('PlayerName').value;
        const pitchtype = document.getElementById('PitchType').value;
        const pVelo = document.getElementById('PitchVelo').value;
        const pitchoutcome = document.getElementById('PitchOutcome').value;
        const swingoutcome = document.getElementById('SwingOutcome').value;
        const eVelo = document.getElementById('ExitVelo').value;

        // Create the data object
        const entry = { 
            player: name, 
            pitchtype: pitchtype, 
            pitchvelo: pVelo, 
            pitchoutcome: pitchoutcome, 
            swingoutcome: swingoutcome,
            exitvelo: eVelo,
            hitlocXX: hitlocXX,
            hitlocYY: hitlocYY,
        };
        
        sessionData.push(entry);
        resetInputs();
    }

    function resetInputs() {
        // Clear numeric/text inputs
        document.getElementById('PitchVelo').value = '';
        document.getElementById('ExitVelo').value = '';

        // Reset dropdowns
        document.getElementById('PitchType').selectedIndex = 0;
        document.getElementById('PitchOutcome').selectedIndex = 0;
        document.getElementById('SwingOutcome').selectedIndex = 0;

        // Reset hit location state
        hitlocXX = null;
        hitlocYY = null;

        // Hide marker
        marker.style.display = "none";

        // Clear hidden inputs
        sprayXInput.value = '';
        sprayYInput.value = '';
    }


    function updateTable(entry) {
        const tbody = document.getElementById('tableBody');
        const row = `<tr>
            <td>${entry.player}</td>
            <td>${entry.pitchtype}</td>
            <td>${entry.pitchvelo || '-'}</td>
            <td>${entry.pitchoutcome || '-'}</td>
            <td>${entry.swingoutcome || '-'}</td>
            <td>${entry.exitvelo || '-'}</td>
            <td>${entry.hitlocXX || '-'}</td>
            <td>${entry.hitlocYY || '-'}</td>
        </tr>`;
        tbody.innerHTML += row;
    }

    function downloadCSV() {
        // Add the new headers to the top of the CSV
        let csvContent = "Player, Pitch Type, Pitch Velo, Pitch Outcome, Swing Outcome, Exit Velo, hitlocXX, hitlocYY\n";
        
        sessionData.forEach(row => {csvContent += `${row.player},${row.pitchtype}, ${row.pitchvelo},${row.pitchoutcome},${row.swingoutcome},${row.exitvelo},${row.hitlocXX},${row.hitlocYY}\n`; });

        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('href', url);
        a.setAttribute('download', 'scout_data.csv');
        a.click();
    }


</script>
</HTML>
