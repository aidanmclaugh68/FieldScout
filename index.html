<HTML>
    <Head>
        <title>RIVALRY ANALYTICS</title>   
    </Head>
<body>

    <h1>Field Scout v1.0</h1>
    <!--EACH OF THE INPUTS-->
    <div id="input-area" style="background: #f4f4f4; padding: 20px; border-radius: 8px; display: inline-block;">

    <!--PLAYER NAME-->
        <input type="text" id="PlayerName" placeholder="Player Name">

    <!--PITCH TYPE-->
        <select id="PitchType">
            <option value="" disabled selected hidden>Pitch Type</option>
            <option value="Fastball">Fastball</option>
            <option value="Curveball">Curveball</option>
            <option value="Changeup">Changeup</option>
            <option value="Slider">Slider</option>
            <option value="Other">Other</option>
        </select>

    <!--PITCH VELO-->
        <input type="number" id="PitchVelo" placeholder="Pitch Velo">

    <!--PITCH OUTCOME-->
        <select id="PitchOutcome">
            <option value="" disabled selected hidden>Pitch Outcome</option>
            <option value="SS">Strike Swinging</option>
            <option value="SL">Strike Looking</option>
            <option value="SC">Strike Check Swing</option>
            <option value="FB">Foul Ball</option>
            <option value="FT">Foul Tip</option>
            <option value="B">Ball</option>
            <option value="HBP">Hit By Pitch</option>
            <option value="IP-Out">In-Play Out</option>
            <option value="IP-Sac">In-Play Sac</option>
            <option value="1B">Single</option>
            <option value="2B">Double</option>
            <option value="3B">Triple</option>
            <option value="HR">Home Run</option>
        </select>

    <!--SWING OUTCOME-->
        <select id="SwingOutcome">
            <option value="" disabled selected hidden>Contact Outcome</option>
            <option value="LD">Line Drive</option>
            <option value="GB">Ground Ball</option>
            <option value="PF">Pop Fly</option>
        </select>

    <!--EXIT VELO-->
        <input type="number" id="ExitVelo" placeholder="Exit Velo">
    
    <!--RECORD EVENT-->
        <button onclick="recordPlay()" style="background-color: #007bff; color: white;">Record Event</button>
    <!--CLEAR EVENT-->
        <button onclick="resetInputs()" style="background-color: #ff0000; color: white;">Clear Event</button>
    </div>

   <!--COUNT AND OUT INDICATOR-->
    <div id="input-area" style="background: #f4f4f4; padding: 20px; border-radius: 8px; display: inline-block;">
        <script>
            let count = {
                balls: 0,
                strikes: 0,
                outs:0,
            };
        </script>
    Balls: <span id="balls">0</span> |
    Strikes: <span id="strikes">0</span> |
    Outs: <span id="outs">0</span>
    </div> 

    <!--HIT LOCATION-->
    <svg id="field" viewBox="0 0 10 10">
        <image
            href="Collection%20App/FieldDiagram.jpeg"
            width="10"
            height="10"
        />  
        <circle id="marker" r=".1" fill="red" style="display:none;" />
    </svg>

    <input type="hidden" id="sprayX" name="sprayX">
    <input type="hidden" id="sprayY" name="sprayY">

    <script>
        let hitlocXX = null;
        let hitlocYY = null;

        const field = document.getElementById("field");
        const marker = document.getElementById("marker");
        const sprayXInput = document.getElementById("sprayX");
        const sprayYInput = document.getElementById("sprayY");
            field.addEventListener("click", (e) => {
                const rect = field.getBoundingClientRect();

                hitlocXX = ((e.clientX - rect.left) / rect.width) * 10;
                hitlocYY = ((e.clientY - rect.top) / rect.height) * 10;

                marker.setAttribute("cx", hitlocXX);
                marker.setAttribute("cy", hitlocYY);
                marker.style.display = "block";

                sprayXInput.value = (hitlocXX / 10).toFixed(4);
                sprayYInput.value = (hitlocYY / 10).toFixed(4);
            });
    </script>

    <!--EXPORT CSV-->
    <button onclick="downloadCSV()"" style="background-color: #ff0000; color: white;">Export CSV</button>


<script>
    let sessionData = [];

    function recordPlay() {
        // Get values from the inputs
        const name = document.getElementById('PlayerName').value;
        const pitchtype = document.getElementById('PitchType').value;
        const pVelo = document.getElementById('PitchVelo').value;
        const pitchoutcome = document.getElementById('PitchOutcome').value;
        const swingoutcome = document.getElementById('SwingOutcome').value;
        const eVelo = document.getElementById('ExitVelo').value;

        // Create the data object
        const entry = { 
            player: name, 
            pitchtype: pitchtype, 
            pitchvelo: pVelo, 
            pitchoutcome: pitchoutcome, 
            swingoutcome: swingoutcome,
            exitvelo: eVelo,
            hitlocXX: hitlocXX,
            hitlocYY: hitlocYY,
        };
        
        sessionData.push(entry);
        updateCount(pitchoutcome, swingoutcome);
        resetInputs();
    }

    function resetInputs() {
        // Clear numeric/text inputs
        document.getElementById('PitchVelo').value = '';
        document.getElementById('ExitVelo').value = '';

        // Reset dropdowns
        document.getElementById('PitchType').selectedIndex = 0;
        document.getElementById('PitchOutcome').selectedIndex = 0;
        document.getElementById('SwingOutcome').selectedIndex = 0;

        // Reset hit location state
        hitlocXX = null;
        hitlocYY = null;

        // Hide marker
        marker.style.display = "none";

        // Clear hidden inputs
        sprayXInput.value = '';
        sprayYInput.value = '';
    }

    function updateCount(pitchOutcome, swingOutcome) {
        // Update balls
        if (pitchOutcome === "B") {
            count.balls++;
            if (count.balls >= 4) { // Walk
                count.balls = 0;
                count.strikes = 0;
                const pitchoutcome = 'BB';
            }
        }

        // Update strikes
        if (["SS", "SL", "SC", "FT"].includes(pitchOutcome)) {
            count.strikes++;
            if (count.strikes >= 3) { // Strikeout
                count.strikes = 0;
                count.balls = 0;
                count.outs++;
                const pitchoutcome = 'SO';

            }
        } 

        if (["FB"].includes(pitchOutcome) && count.strikes <2) {
            count.strikes++;
            if (count.strikes >= 3) { // Strikeout
                count.strikes = 0;
                count.balls = 0;
                count.outs++;
            }
        }

        // Update outs for in-play outs
        if (pitchOutcome === "IP-Out") {
            count.outs++;
            count.balls = 0;
            count.strikes = 0;
        }

        // Reset balls & strikes for any in-play hit/sac
        if (["IP-Hit","IP-Sac"].includes(pitchOutcome)) {
            count.balls = 0;
            count.strikes = 0;
        }

        // Update the display
        document.getElementById("balls").textContent = count.balls;
        document.getElementById("strikes").textContent = count.strikes;
        document.getElementById("outs").textContent = count.outs;
        if (count.outs >= 3) {
        count.outs = 0;
        document.getElementById("outs").textContent = count.outs;
}
    }


    function updateTable(entry) {
        const tbody = document.getElementById('tableBody');
        const row = `<tr>
            <td>${entry.player}</td>
            <td>${entry.pitchtype}</td>
            <td>${entry.pitchvelo || '-'}</td>
            <td>${entry.pitchoutcome || '-'}</td>
            <td>${entry.swingoutcome || '-'}</td>
            <td>${entry.exitvelo || '-'}</td>
            <td>${entry.hitlocXX || '-'}</td>
            <td>${entry.hitlocYY || '-'}</td>
        </tr>`;
        tbody.innerHTML += row;
    }

    function downloadCSV() {
        // Add the new headers to the top of the CSV
        let csvContent = "Player, Pitch Type, Pitch Velo, Pitch Outcome, Swing Outcome, Exit Velo, hitlocXX, hitlocYY\n";
        
        sessionData.forEach(row => {csvContent += `${row.player},${row.pitchtype}, ${row.pitchvelo},${row.pitchoutcome},${row.swingoutcome},${row.exitvelo},${row.hitlocXX},${row.hitlocYY}\n`; });

        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('href', url);
        a.setAttribute('download', 'scout_data.csv');
        a.click();
    }


</script>
</HTML>
